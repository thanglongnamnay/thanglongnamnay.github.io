"use strict";import Util from"./util-module.min.js";import Vector from"./Vector.min.js";import Polygon from"./Polygon.min.js";const scale=2,util=Util(2),$=e=>document.getElementById(e),canvasList=document.getElementsByClassName("figure-canvas");let polygonList=[],wph=canvasList[0].width/canvasList[0].height;const rect=Polygon(util.randomColor(),[Vector(0,0),Vector(0,.2),Vector(.3,.2),Vector(.3,0)]);polygonList.push(rect.move(Vector(.1*wph,.1)),rect.move(Vector(.6*wph,.4)),rect.move(Vector(.2*wph,.5)));const workers=[];for(let e=0;e<canvasList.length;++e){const o=canvasList[e].transferControlToOffscreen();workers.push(new Worker("worker.min.js")),workers[e].postMessage({index:e,offscreen:o,polygonList:polygonList.map(e=>e.toObject())},[o]),canvasList[e].onmousemove=handleMouseMove(e),canvasList[e].onclick=handleMouseClick(e)}const lastWorkerIndex=canvasList.length-1,lastWorker=workers[canvasList.length-1];function handleMouseMove(e){return function(o){o.preventDefault(),workers[e].postMessage({index:e,type:"move",e:util.getXY(o)})}}function handleMouseClick(e){return function(o){o.preventDefault(),workers[e].postMessage({index:e,type:"click",e:util.getXY(o)})}}function handleKeyUp(e){return function(o){o.preventDefault(),workers[e].postMessage({index:e,type:"keyup",e:{which:o.which||o.keyCode||0}})}}function requestApply(e){return function(o){workers[e].postMessage({index:e,type:"apply",e:1})}}function requestReset(e){return function(o){workers[e].postMessage({index:e,type:"reset",e:1})}}function randomPolygons(){polygonList.length=0;const e=5*Math.random()+1>>0;for(let o=0;o<e;++o){const e=[],o=3*Math.random()+2>>0;for(let t=0;t<o;++t)e.push(Vector(Math.random()*wph,Math.random()));polygonList.push(Polygon(util.randomColor(),e))}}document.body.onkeyup=handleKeyUp(lastWorkerIndex),$("apply-button").onclick=requestApply(lastWorkerIndex),$("reset-button").onclick=requestReset(lastWorkerIndex),$("random-button").onclick=lastWorker.onmessage=e=>{randomPolygons(),e.data&&(polygonList=e.data.map(Polygon.fromObject));for(let e=0;e<canvasList.length;++e)workers[e].postMessage({index:e,polygonList:polygonList.map(e=>e.toObject())})},$("switch-mode-6k").onclick=e=>{e.preventDefault(),console.log(e),workers[3].postMessage({index:3,type:"switch-mode-6k",e:1})};