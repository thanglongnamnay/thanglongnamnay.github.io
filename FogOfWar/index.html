<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Fog of war in 2D game and how to make it.">
    <link rel="shortcut icon" type="image/png" href="/icon.png"/>
    <link rel="stylesheet" href="/style.css">
    <title>Fog of war</title>
    <link rel="stylesheet" href="/markdown.css">
</head>
<body>
    <main class="stack"> 
        <h1>Má»™t chÃºt vá» Ã¡nh sÃ¡ng trong lÃ m game.</h1>
        <p>HÃ´m nay Ä‘ang lÃ m má»™t game (3d) thÃ¬ tá»± nhiÃªn mÃ¬nh nghÄ© Ä‘áº¿n viá»‡c implement cÃ¡i <a href="https://dota2.gamepedia.com/Vision#Fog_of_War">Fog of War</a> nhÆ° á»Ÿ trong Doto.</p>

        <h2>ÄÆ¡n giáº£n hoÃ¡</h2>
        <p>ThÃ¬ mÃ¬nh báº¯t Ä‘áº§u tá»« bÃ i toÃ¡n á»Ÿ trong 2D. TrÆ°á»›c tiÃªn ta pháº£i chuáº©n bá»‹ má»™t máº·t pháº³ng, trÃªn Ä‘Ã³ cÃ³ má»™t vÃ i chÆ°á»›ng ngáº¡i váº­t mÃ  tá»« má»™t vá»‹ trÃ­ báº¥t ká»³ thÃ¬ ngÆ°á»i chÆ¡i sáº½ khÃ´ng thá»ƒ nhÃ¬n tháº¥y nhá»¯ng gÃ¬ bá»‹ khuáº¥t bá»Ÿi cÃ¡c chÆ°á»›ng ngáº¡i váº­t Ä‘Ã³. NhÆ° sau:</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>CÃ¡ch Ä‘áº§u tiÃªn nghÄ© ngay Ä‘áº¿n, báº¯t nguá»“n tá»« cÃ¡ch máº¯t ngÆ°á»i hoáº¡t Ä‘á»™ng, lÃ  tá»« vá»‹ trÃ­ ngÆ°á»i chÆ¡i, váº½ cÃ¡c tia báº¯n  ra xung quanh, cÃ¡c tia cÃ¡ch Ä‘á»u nhau, gáº·p chÆ°á»›ng ngáº¡i váº­t thÃ¬ dá»«ng láº¡i táº¡i Ä‘iá»ƒm tiáº¿p xÃºc. Khi Ä‘Ã³ ta sáº½ Ä‘Æ°á»£c táº­p há»£p cÃ¡c Ä‘iá»ƒm tiáº¿p xÃºc mÃ  á»Ÿ Ä‘Ã³ táº§m nhÃ¬n khÃ´ng thá»ƒ Ä‘i xa hÆ¡n Ä‘Æ°á»£c ná»¯a. Äá»‘i vá»›i cÃ¡c tia khÃ´ng gáº·p chÆ°á»›ng ngáº¡i váº­t thÃ¬ ta coi nhÆ° Ä‘iá»ƒm tiáº¿p xÃºc cá»§a tia Ä‘Ã³ lÃ  á»Ÿ xa vÃ´ cÃ¹ng.
        Sau khi ná»‘i cÃ¡c Ä‘iá»ƒm tiáº¿p xÃºc Ä‘Ã³ láº¡i vá»›i nhau thÃ¬ ta sáº½ Ä‘Æ°á»£c má»™t Ä‘a giÃ¡c, ta cÃ³ thá»ƒ dá»… dÃ ng chá»©ng minh Ä‘Æ°á»£c má»i Ä‘iá»ƒm trÃªn cÃ¡c tia báº¯n ra tá»« vá»‹ trÃ­ ngÆ°á»i chÆ¡i vÃ  náº±m trong Ä‘a giÃ¡c trÃªn thÃ¬ Ä‘á»u náº±m trong táº§m nhÃ¬n. Do Ä‘Ã³, khi sá»‘ lÆ°á»£ng tia xung quanh tiáº¿n Ä‘áº¿n vÃ´ cÃ¹ng thÃ¬ ta sáº½ Ä‘Æ°á»£c má»™t Ä‘a giÃ¡c vÃ´ sá»‘ cáº¡nh biá»ƒu diá»…n táº§m nhÃ¬n.
        HÃ¬nh sau thá»ƒ hiá»‡n giáº£i thuáº­t trÃªn vá»›i 60 tia báº¯n Ä‘á»u ra xung quanh.</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>NhÆ° ta tháº¥y, náº¿u sá»‘ tia quÃ¡ Ã­t thÃ¬ táº§m nhÃ¬n sáº½ khÃ´ng chuáº©n, cÃ³ cáº£m giÃ¡c giáº­t lag khi di chuyá»ƒn.</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>Náº¿u sá»‘ tia quÃ¡ nhiá»u thÃ¬ táº§m nhÃ¬n sáº½ chuáº©n hÆ¡n sáº½ ráº¥t áº£nh hÆ°á»Ÿng Ä‘áº¿n performance, do Ä‘Ã³ sáº½ khÃ´ng mÆ°á»£t hÆ¡n. NhÆ° hÃ¬nh sau lÃ  biá»ƒu diá»…n vá»›i 6.000 tia. </p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <blockquote><p>ÃŠ, sao tÃ´i cháº£ tháº¥y gÃ¬ cáº£?</p></blockquote>

        <p>Ã”ng pháº£i click, náº¿u tÃ´i cáº­p nháº­t khi Ã´ng di chuá»™t thÃ¬ mÃ¡y tÃ´i sáº½ lÄƒn ra cháº¿t (thá»±c ra lÃ  khÃ´ng nhÆ°ng mÃ  nÃ³ ráº¥t cháº­m). CÃ²n náº¿u mÃ¡y Ã´ng máº¡nh thÃ¬ click vÃ o <a id="switch-mode-6k">Ä‘Ã¢y</a></p>

        <blockquote><p>Ok, váº­y náº¿u Ã­t tia thÃ¬ xáº¥u, nhiá»u tia thÃ¬ cháº­m thÃ¬ pháº£i lÃ m tháº¿ nÃ o?</p></blockquote>

        <h2>Giáº£i quyáº¿t váº¥n Ä‘á»</h2>
        <p>Khi gáº·p má»™t váº¥n Ä‘á» vá» performance thÃ¬ ta cÃ³ 2 cÃ¡ch giáº£i quyáº¿t:</p>
        <ol>
            <li>Äá»•i sang mÃ¡y xá»‹n hÆ¡n.</li>
            <li>Thay Ä‘á»•i thuáº­t toÃ¡n cÃ³ Ä‘á»™ phá»©c táº¡p thá»i gian tá»‘t hÆ¡n.</li>
        </ol>

        <p>TÃ´i thÃ­ch dÃ¹ng cÃ¡ch trÆ°á»›c hÆ¡n nÃªn chÃºng ta sáº½ dÃ¹ng cÃ¡ch 2.
        NhÆ° Ã´ng Ä‘á»ƒ Ã½ thÃ¬ á»Ÿ cÃ¡ch trÃªn, cÃ¡c Ä‘á»‰nh cá»§a chÆ°á»›ng ngáº¡i váº­t sáº½ Ã­t khi cÃ³ tia nÃ o báº¯n trÃºng, vÃ  do Ä‘Ã³ cÃ¡c gÃ³c sáº½ bá»‹ cáº¯t cá»¥t Ä‘i. Khi tÄƒng sá»‘ tia lÃªn thÃ¬ Ä‘á»‰nh sáº½ dá»… Ä‘Æ°á»£c báº¯n trÃºng hÆ¡n, do Ä‘Ã³ giáº£m cáº£m giÃ¡c gÃ£y cáº¡nh.
        Do Ä‘Ã³ ta nghÄ© Ä‘áº¿n cÃ¡ch nhÆ° cÃ¡c pháº§n má»m váº½ sá»­ dá»¥ng: báº¯t Ä‘iá»ƒm. Tia á»Ÿ gáº§n Ä‘á»‰nh cá»§a chÆ°á»›ng ngáº¡i váº­t nháº¥t sáº½ báº¯t luÃ´n vÃ o Ä‘á»‰nh Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c tia gáº§n Ä‘á»‰nh nháº¥t báº±ng cÃ¡ch tÃ­nh gÃ³c giá»¯a cÃ¡c tia báº¯n ra vÃ  tia tá»« vá»‹ trÃ­ ngÆ°á»i chÆ¡i Ä‘áº¿n Ä‘á»‰nh cá»§a chÆ°á»›ng ngáº¡i váº­t ğ›¼. Náº¿u 2ğ›¼ &lt; ğ›½, vá»›i ğ›½ lÃ  gÃ³c giá»¯a 2 tia báº¯n ra, thÃ¬ tia Ä‘Ã³ lÃ  tia gáº§n Ä‘á»‰nh nháº¥t.
        Khi Ä‘Ã³, ta tháº¥y lÃ  cÃ¡c tia báº¯t vÃ o Ä‘á»‰nh ráº¥t quan trá»ng, vÃ  cÃ¡c tia cÃ²n láº¡i, tiáº¿p xÃºc vá»›i chÆ°á»›ng ngáº¡i váº­t trÃªn cáº¡nh thÃ¬ gáº§n nhÆ° khÃ´ng cÃ³ tÃ¡c dá»¥ng gÃ¬, chá»‰ cÃ³ tÃ¡c dá»¥ng ná»‘i 2 Ä‘á»‰nh láº¡i vá»›i nhau. Do Ä‘Ã³ ta cÃ³ thá»ƒ bá» qua cÃ¡c tia tiáº¿p xÃºc trÃªn cáº¡nh.
        NhÆ° váº­y, thay vÃ¬ táº¡o ra nhiá»u tia rá»“i báº¯t Ä‘á»‰nh , loáº¡i bá» cÃ¡c tia thá»«a. Ta cÃ³ thá»ƒ chá»‰ táº¡o ra cÃ¡c tia tá»« vá»‹ trÃ­ ngÆ°á»i chÆ¡i Ä‘áº¿n cÃ¡c Ä‘á»‰nh, rá»“i xÃ©t cÃ¡c tia Ä‘Ã³ lÃ  Ä‘Æ°á»£c (chÃº Ã½ lÃ  cÃ¡c tia Ä‘Ã³ sáº½ cáº¯t chÆ°á»›ng ngáº¡i váº­t táº¡i 1 Ä‘iá»ƒm nhÆ°ng váº«n tiáº¿p tá»¥c Ä‘Æ°á»£c kÃ©o dÃ i vÃ  xÃ©t tiáº¿p, vÃ¬ táº§m nhÃ¬n sáº½ cÃ³ thá»ƒ chá»‰ bá»‹ cháº·n á»Ÿ 1 phÃ­a). Khi Ä‘Ã³ ta khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n cÃ´ng thá»©c 2ğ›¼ &lt; ğ›½ ná»¯a vÃ¬ cÃ¡c tia cháº¯c cháº¯n Ä‘i qua Ä‘á»‰nh. Má»™t cÃ´ng Ä‘Ã´i viá»‡c.</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>VÃ¬ ta cÃ¡c tia cho tá»«ng hÃ¬nh mÃ  khÃ´ng sáº¯p xáº¿p láº¡i thÃ¬ sáº½ khÃ´ng Ä‘Æ°á»£c. Do Ä‘Ã³, sau khi sáº¯p xáº¿p láº¡i cÃ¡c hÃ¬nh thÃ¬ ta sáº½ Ä‘Æ°á»£c káº¿t quáº£ sau:</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>Váº«n cÃ³ gÃ¬ Ä‘Ã³ sai sai Ä‘Ãºng khÃ´ng? Khi vá»‹ trÃ­ ngÆ°á»i chÆ¡i á»Ÿ trung tÃ¢m thÃ¬ á»•n, nhÆ°ng khi Ä‘Æ°a ra dÃ¬a thÃ¬ láº¡i khÃ´ng á»•n ná»¯a. VÃ¬ 2 tia á»Ÿ ngoÃ i cÃ¹ng ná»‘i vá»›i nhau nÃªn nÃ³ táº¡o nÃªn má»™t tam giÃ¡c to tá»• bá»‘, vÃ  tam giÃ¡c Ä‘Ã³ Ä‘Ã¨ lÃªn trÃªn pháº§n cÃ²n láº¡i cá»§a nÃ³.
        Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y thÃ¬ ta xÃ©t thÃªm 1 "chÆ°á»›ng ngáº¡i váº­t" ná»¯a lÃ  hÃ¬nh chá»¯ nháº­t khung nhÃ¬n. Works like a charm.</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>
        
        <h2>Nhá»¯ng thá»© cáº§n cáº£i thiá»‡n</h2>
        <p>Thuáº­t toÃ¡n trÃªn chá»‰ lÃ m viá»‡c khi cÃ¡c chÆ°á»›ng ngáº¡i váº­t khÃ´ng Ä‘Ã¨ lÃªn nhau, vÃ  khÃ´ng cÃ³ Ä‘a giÃ¡c tá»± cáº¯t. Do Ä‘Ã³ ta sáº½ cáº£i tiáº¿n nÃ³ má»™t chÃºt, trÆ°á»›c khi xÃ©t cÃ¡c tia báº¯n vÃ o Ä‘á»‰nh, ta xÃ©t thÃªm cÃ¡c Ä‘á»‰nh lÃ  giao Ä‘iá»ƒm cá»§a 2 cáº¡nh báº¥t ká»³.  VÃ  Ä‘Ã¢y lÃ  káº¿t quáº£ cuá»‘i cÃ¹ng.</p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas>

        <p>CÃ¹ng vá»›i Play Ground cho cÃ¡c báº¡n. Chuá»™t pháº£i Ä‘á»ƒ váº½ chÆ°á»›ng ngáº¡i váº­t, Enter Ä‘á»ƒ nháº¥c bÃºt. PS: HÃ¬nh cÃ ng phá»©c táº¡p, cÃ ng cÃ³ nhiá»u Ä‘iá»ƒm tá»± cáº¯t thÃ¬ thuáº­t toÃ¡n thá»© hai sáº½ cháº¡y cÃ ng cháº­m, Ä‘áº¿n 1 lÃºc nÃ o Ä‘Ã³ thÃ¬ nÃ³ sáº½ cháº­m hÆ¡n thuáº­t toÃ¡n thá»© nháº¥t (vá»›i 6000 tia). Khi Ä‘Ã³ ta sáº½ cÃ³ 2 cÃ¡ch xá»­ lÃ½: 1 lÃ  Ä‘á»•i sang thuáº­t toÃ¡n thá»© nháº¥t, 2 lÃ  cáº£i tiáº¿n thuáº­t toÃ¡n thá»© hai, 3 lÃ  tÄƒng cáº¥u hÃ¬nh yÃªu cáº§u lÃªn RTX2080.</p>
        <p>
            <button id="apply-button" title="Ãp dá»¥ng chÆ°á»›ng ngáº¡i váº­t nÃ y cho cÃ¡c hÃ¬nh á»Ÿ trÃªn">Ãp dá»¥ng</button>
            <button id="reset-button" title="cuá»™c Ä‘á»i">LÃ m láº¡i</button>
            <button id="random-button" title="LÃ m gÃ¬ cÃ³ gÃ¬ ngáº«u nhiÃªn">Ngáº«u nhiÃªn</button>  
        </p>

        <canvas class="figure-canvas" width="1600" height="900"></canvas><br>

        <blockquote><p>ÄÆ°á»ng cong thÃ¬ sao, Ä‘Æ°á»ng cong lÃ m gÃ¬ cÃ³ Ä‘á»‰nh nÃ o mÃ  lÃ m kiá»ƒu nÃ y?</p></blockquote>

        <p>Khi gáº·p má»™t váº¥n Ä‘á» vá»... Ã€ cÃ¡i nÃ y khÃ´ng pháº£i vá» performance. Ã”ng cÃ³ thá»ƒ fallback vá» cÃ¡ch ban Ä‘áº§u, báº¯n 6.000 tia ra kháº¯p nÆ¡i. Hoáº·c cÃ³ thá»ƒ coi Ä‘Æ°á»ng cong lÃ  táº­p há»£p vÃ´ sá»‘ Ä‘oáº¡n tháº³ng, do Ä‘Ã³ cÃ³ vÃ´ sá»‘ Ä‘á»‰nh. NhÆ°ng Ä‘á»‘i vá»›i cÃ¡c Ä‘Æ°á»ng cong Ä‘Æ¡n giáº£n nhÆ° hÃ¬nh trÃ²n hay eclipse thÃ¬ ta cÃ³ thá»ƒ chá»‰ cáº§n tÃ¬m vÃ  xÃ©t 2 Ä‘iá»ƒm trÃªn Ä‘Ã³ mÃ  táº¡o vá»›i vá»‹ trÃ­ ngÆ°á»i chÆ¡i má»™t gÃ³c lá»›n nháº¥t. Khi Ä‘Ã³ thuáº­t toÃ¡n trÃªn váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.</p>

        <blockquote><p>Váº­y trÃªn 3D thÃ¬ lÃ m nhÆ° tháº¿ nÃ o??</p></blockquote>

        <p>TÃ´i chÆ°a lÃ m trÃªn 3D, vÃ¬ trÃªn Ä‘Ã³ máº¥y cÃ¡i Ã¡nh sÃ¡ng Ä‘Æ°á»£c lo háº¿t bá»Ÿi engine rá»“i, mÃ¬nh cháº£ cÃ³ viá»‡c gÃ¬ Ä‘á»ƒ lÃ m cáº£. NhÆ°ng mÃ  tÆ° tÆ°á»Ÿng cháº¯c lÃ  cÅ©ng nhÆ° váº­y, cÃ³ thá»ƒ há» dÃ¹ng cÃ¡ch thá»© nháº¥t, vÃ¬ cÃ¡ch Ä‘Ã³ ráº¥t cháº­m náº¿u lÃ m trÃªn CPU, nhÆ°ng mÃ  sáº½ ráº¥t nhanh trÃªn GPU. VÃ  nhÆ° tháº¿ lÃ  chÃºng ta cÃ³ Ray Tracing ğŸ™ƒ.</p>
    </main>
    
    <script type="module" src="app.js"></script>
    <script src="/breadcrumb.js"></script>
</body>
</html>