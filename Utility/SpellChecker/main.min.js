import{debounce,chain}from"./util.min.js";const dictionary={},marks=".,?!()'\"",delims=/[\d\.,\?\!\(\)\'\"\-\:\=\+\*\/]/g,seperate=e=>e.replace(delims," "),removeRedundanceSpaces=e=>e.replace(/[\u00a0 ]{2,}/g," "),addSpaceAfterMark=e=>e.replace(/[\.,\?\!\)-](?! )/g,"$& "),standalize=e=>addSpaceAfterMark(removeRedundanceSpaces(e)),removeMark=e=>0===e.length?e:e.replace(delims,""),checker=e=>{const t={};return{check:async n=>{if(0===n.length)return!0;const a=removeMark(n).toLocaleLowerCase("vi");if(null!=t[a])return t[a];if(e.includes(a))return t[a]=!0,!0;const c=await fetch(`https://dict.laban.vn/ajax/widget-search?type=1&query=${a}&vi=1`),r=await c.json();if(0!==r.error)throw Error("Network error.");return t[a]=!!r.viEnData&&!!r.viEnData.best,t[a]},get dictionary(){return t}}},textInput=document.getElementById("text-input"),checkButton=document.getElementById("check-button"),notEmpty=e=>e.length>0,empty=e=>0===e.length,handleCheck=e=>async t=>{console.log(standalize(textInput.textContent)),textInput.innerHTML=standalize(textInput.textContent);const n=seperate(textInput.textContent).split(/\s/).map(removeMark).filter(notEmpty);console.log(n);for(let t=0;t<n.length;++t){const a=n[t];if((a-0).toString()===a)return;if(!await e.check(a)){const c=(n[t-1]||"")+" "+a,r=a+" "+(n[t+1]||"");await e.check(c)||await e.check(r)||(textInput.innerHTML=textInput.innerHTML.replace(RegExp(/(\W)/.source+RegExp(a).source+/(\W)/.source,"g"),'$1<span class="wrong">'+a+"</span>$2"))}}},main=async()=>{const e=await(await fetch("./vv30K_lst.json")).json();console.log("LIST:",e),console.log("FIND:",e.indexOf("x√¥i")),checkButton.onclick=handleCheck(checker(e))};main();