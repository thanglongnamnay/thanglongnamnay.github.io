"use strict";!function(){const e=e=>document.getElementById(e),t=io("https://longcppblog.herokuapp.com/artgroup"),n=e("canvas"),o=2;n.width=720*o,n.height=480*o;const r=e("penSizeLabel"),a=e("penSize"),i=e("penColor"),s=e("btnClear"),c=e("pVoteClear"),l=e("btnAgree"),u=e("btnDisagree"),d=e("btnDownload"),f=e("population");a.min=o,a.max=12*o,a.step=o,a.value=4*o;let g,v,p,m,h,x,y=!1,D=a.value,L=i.value;function T(e){l.hidden=e,u.hidden=e}function w(e){e.preventDefault();const t=b(e);y&&x(g,v,t.x,t.y,D,L),z(t)}function E(e){e.preventDefault(),z(b(e)),y=!0}function k(e){e.preventDefault(),y=!1}function b(e){return{x:(e.offsetX||e.touches[0].clientX-e.target.offsetLeft)*o,y:(e.offsetY||e.touches[0].clientY-e.target.offsetTop)*o}}function z(e){g=e.x,v=e.y}a.onchange=e=>{D=e.target.value,r.innerText=`Pen's size ${e.target.value} `},i.onchange=e=>{L=e.target.value},d.onclick=e=>{const t=n.toDataURL("image/png");e.target.href=t},n.transferControlToOffscreen?(p=new Worker("worker.min.js"),m=n.transferControlToOffscreen(),p.postMessage({canvas:m},[m]),x=(e,n,o,r,a,i,s=!0)=>{p.postMessage({x1:e,y1:n,x2:o,y2:r,size:a,color:i}),s&&t.emit("draw",{x1:e,y1:n,x2:o,y2:r,size:a,color:i})}):((h=n.getContext("2d")).lineCap="round",h.lineJoin="round",x=(e,n,o,r,a,i,s=!0)=>{h.strokeStyle=i,h.lineWidth=a,h.beginPath(),h.moveTo(e,n),h.lineTo(o,r),h.closePath(),h.stroke(),s&&t.emit("draw",{x1:e,y1:n,x2:o,y2:r,size:a,color:i})}),n.addEventListener("mousedown",E),n.addEventListener("mouseup",function(e){e.preventDefault(),z(b(e)),y=!1}),n.addEventListener("mouseleave",function(e){e.preventDefault();const t=b(e);y&&x(g,v,t.x,t.y,D,L);y=!1}),n.addEventListener("mouseenter",function(e){e.preventDefault(),z(b(e))}),n.addEventListener("mousemove",w),n.addEventListener("touchstart",E),n.addEventListener("touchend",k),n.addEventListener("touchcancel",k),n.addEventListener("touchmove",w),s.onclick=()=>{t.emit("clear"),c.innerText="Agree: 1. Disagree: 0",T(!1)},l.onclick=()=>{t.emit("vote clear",!0)},u.onclick=()=>{t.emit("vote clear",!1)},t.on("welcum",e=>f.innerText=`${e} people in room. `),t.on("draw",e=>{const{x1:t,y1:n,x2:o,y2:r,size:a,color:i}=e;x(t,n,o,r,a,i,!1)}),t.on("vote clear",()=>{c.innerText="Agree: 1. Disagree: 0",T(!1)}),t.on("someone voted",e=>{c.innerText=`Agree: ${e.agree}. Disagree: ${e.disagree}`}),t.on("clear",()=>{p?p.postMessage("clear"):h.clearRect(0,0,n.width,n.height),c.innerText="",T(!0),t.emit("cleared")}),t.on("not clear",()=>{c.innerText="",T(!0),t.emit("cleared")})}();